{% extends "base.html" %}
{% block content %}
  <style>
    .did-list { display:flex; flex-direction: column; gap: 16px; }
    .did-card .header { display:flex; justify-content: space-between; align-items: center; gap: 12px; }
    .did-card .header .left { min-width: 0; }
    .did-card .company { font-weight: 800; color:#000; }
    .did-card .did { word-break: break-all; }
    .did-card .actions { display:flex; gap:10px; align-items:center; }
    .cred-list { margin-top: 12px; border-top: 1px solid var(--border); padding-top: 12px; }
    .cred-item { display:flex; justify-content: space-between; align-items: center; padding: 8px 0; }
    .cred-item + .cred-item { border-top: 1px solid var(--border); }
    .cred-item .title { font-weight: 600; color:#000; }
    .cred-item .meta { display:flex; gap: 12px; align-items:center; }
    .add-btn { display:inline-flex; align-items:center; justify-content:center; width: 32px; height: 32px; border:1px solid var(--border); background:#fff; color:#000; border-radius: 6px; text-decoration:none; font-weight:800; }
    .add-btn:hover { background:#f4f4f4; }
  </style>

  <div class="dashboard">
    <h1>DIDs</h1>

    {% if dids %}
      <div class="did-list">
        {% for d in dids %}
          <div class="card did-card">
            <div class="header">
              <div class="left">
                <div class="company">{{ d.company }}</div>
                <div class="small did">{{ d.did_id }}</div>
              </div>
              <div class="actions">
                <span class="badge {{ d.kyc_status }}">{{ d.kyc_status }}</span>
                <a href="/did/{{ d.id }}"><button class="secondary" type="button">View DID</button></a>
                {% if d.kyc_status == 'approved' %}
                  <a class="add-btn" title="Create Credential" href="/did/{{ d.id }}/credentials/new">+</a>
                {% endif %}
              </div>
            </div>
            {% set dcreds = creds | selectattr('did_id','equalto', d.id) | list %}
            <div class="cred-list">
              {% if dcreds %}
                {% for c in dcreds %}
                  <div class="cred-item">
                    <div class="title">{{ c.label }}</div>
                    <div class="meta">
                      <span class="badge {% if c.status=='revoked' %}rejected{% else %}approved{% endif %}">{{ c.status }}</span>
                      <a href="/did/{{ c.did_id }}/credentials/{{ c.id }}"><button type="button">View</button></a>
                      <a href="/did/{{ c.did_id }}/credentials/{{ c.id }}/download"><button class="secondary" type="button">Download</button></a>
                    </div>
                  </div>
                {% endfor %}
              {% else %}
                <div class="small">No credentials yet. {% if d.kyc_status == 'approved' %}<a href="/did/{{ d.id }}?simple=1#create-credential">Create one</a>.{% else %}Complete KYC and approval to create credentials.{% endif %}</div>
              {% endif %}
            </div>
          </div>
        {% endfor %}
      </div>
    {% else %}
      <div class="card">
        <h2>Your DIDs</h2>
        <p class="hint">No DIDs yet. Create your first project to get started.</p>
        <div class="actions"><a href="/wizard/start"><button>Create DID</button></a></div>
      </div>
    {% endif %}
  </div>
{% endblock %}
